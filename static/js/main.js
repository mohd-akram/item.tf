function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}(function(){var HoverBox,Item,ItemBox,User,_getAjaxRequest,ajax,capitalize,escapeHTML,getCookie,postAjax,priceSources,root,setCookie,indexOf=[].indexOf;root=typeof exports!=="undefined"&&exports!==null?exports:this;priceSources=["backpack.tf","trade.tf"];User=function(){"use strict";function User(){_classCallCheck(this,User);this.id=getCookie("steam_id");this.loggedIn=Boolean(this.id);Object.defineProperties(this,{priceSource:{get:function get(){return getCookie("price_source")||priceSources[0]},set:function set(source){return setCookie("price_source",source,365)}}})}_createClass(User,[{key:"isOwnPage",value:function isOwnPage(){var ref;return this.loggedIn&&this.id===((ref=document.getElementById("steamid"))!=null?ref.getAttribute("data-id"):void 0)}}]);return User}();Item=function(){"use strict";function Item(elem1){_classCallCheck(this,Item);var j,len,price,ref,ref1,ref2,ref3,ref4,ref5,ref6,source;this.elem=elem1;this.name=this.elem.title;this.id=this.elem.getAttribute("data-index");this.url=this.elem.getAttribute("data-url");this.imageUrl=this.elem.getAttribute("data-image");this.description=this.elem.getAttribute("data-description")||"";this.level=this.elem.getAttribute("data-level");this.attributes=((ref=this.elem.getElementsByTagName("div"))!=null?(ref1=ref[0])!=null?ref1.innerHTML:void 0:void 0)||"";this.classes=((ref2=this.elem.getAttribute("data-classes"))!=null?ref2.split(","):void 0)||[];this.tags=((ref3=this.elem.getAttribute("data-tags"))!=null?ref3.split(","):void 0)||[];this.storePrice=this.elem.getAttribute("data-storeprice");this.blueprints=this.elem.getElementsByTagName("ul");this.prices={};for(j=0,len=priceSources.length;j<len;j++){source=priceSources[j];price=JSON.parse((ref4=(ref5=this.elem.getAttribute("data-".concat(source)))!=null?ref5.replace('Collector"s',"Collector's"):void 0)!=null?ref4:null);if(price){this.prices[source]=price}}this.wishIndex=this.elem.getAttribute("data-i");this.qualityNo=(ref6=this.elem.className.match(/quality-(\d+)/))!=null?ref6[1]:void 0}_createClass(Item,[{key:"remove",value:function remove(){return this.elem.parentNode.removeChild(this.elem)}}]);return Item}();ItemBox=function(){"use strict";function ItemBox(){var showLink=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;_classCallCheck(this,ItemBox);this.showLink=showLink;this.elem=document.createElement("div");this.elem.id="itembox";document.body.appendChild(this.elem)}_createClass(ItemBox,[{key:"show",value:function show(elem){var source;this.item=new Item(elem);this.sources=function(){var j,len,results;results=[];for(j=0,len=priceSources.length;j<len;j++){source=priceSources[j];if(source in this.item.prices){results.push(source)}}return results}.call(this);this.source=user.priceSource;this._generate();return this.elem.style.display="block"}},{key:"hide",value:function hide(){return this.elem.style.display="none"}},{key:"_nextPriceSource",value:function _nextPriceSource(){return this.source=this.sources[(this.sources.indexOf(this.source)+1)%this.sources.length]}},{key:"_tagsHTML",value:function _tagsHTML(){var html,i,image,isToken,isWeapon,j,k,len,len1,ref,ref1,title;if(this.item.tags.length){html='<div id="tags">';isWeapon=indexOf.call(this.item.tags,"weapon")>=0;isToken=indexOf.call(this.item.tags,"token")>=0;ref=["primary","secondary","melee","pda2"];for(j=0,len=ref.length;j<len;j++){i=ref[j];if(indexOf.call(this.item.tags,i)>=0){if(isWeapon){title="".concat(capitalize(i)," Weapon");image=i}else if(isToken){title="Slot Token";image="slot-token"}}}ref1=["hat","misc","tool","bundle"];for(k=0,len1=ref1.length;k<len1;k++){i=ref1[k];if(indexOf.call(this.item.tags,i)>=0){var _ref=[capitalize(i),i];title=_ref[0];image=_ref[1]}}if(isToken&&this.item.classes.length){title="Class Token";image="class-token"}if(title!=null&&image!=null){html+='<a href="/search?q='.concat(encodeURIComponent(title),'"\n target="_blank" title="').concat(title,'" class="').concat(image,'"></a>')}return html+="</div>"}else{return""}}},{key:"_nameHTML",value:function _nameHTML(){var html;html=this.item.name;if(this.showLink){html='<a href="'.concat(this.item.url,'"\n class="glow" title="Go to Item Page">').concat(html,"</a>")}return html='<h2 id="itemname">'.concat(html,'</h2>\n<i id="shortlinkbutton" class="fa fa-caret-square-o-down"\n title="Short URL"></i><br>\n<div id="shortlink" style="display:none">\n<input type="text" value="https://item.tf/').concat(this.item.id,'" readonly><br>\n</div>')}},{key:"_classesHTML",value:function _classesHTML(){var class_,html,j,len,ref;if(this.item.classes.length){html='<div id="classes">';ref=this.item.classes;for(j=0,len=ref.length;j<len;j++){class_=ref[j];html+='<a href="/search?q='.concat(class_,'" target="_blank"\n title="').concat(class_,'" class="').concat(class_.toLowerCase(),'"></a>')}return html+="</div>"}else{return""}}},{key:"_bundleHTML",value:function _bundleHTML(){if(indexOf.call(this.item.tags,"bundle")>=0&&this.item.description.indexOf("---")!==-1){return'<a href="/search?q='.concat(encodeURIComponent(this.item.name),'%20Set"\n target="_blank">\n<div class="rounded glow" style="display: inline-block; padding: 7px">\nView Items\n</div>\n</a>')}else{return""}}},{key:"_priceSourceHTML",value:function _priceSourceHTML(){var denom,denomMatch,html,j,len,price,qualities,quality;html="";if(!this.item.prices[this.source]){this._nextPriceSource()}if(this.item.prices[this.source]){qualities=Object.keys(this.item.prices[this.source]).sort();for(j=0,len=qualities.length;j<len;j++){quality=qualities[j];price=this.item.prices[this.source][quality];denomMatch=price.match(/(Refined|Key(s)?|Bud(s)?)/);if(denomMatch){denom=denomMatch[0];price=price.replace(/(\d+(\.\d+)?)/g,"<a href='/search?q=$1%20".concat(denom,"' target='_blank' class='glow'>$1</a>"))}html+='<a href="/search?q='.concat(quality,'" target="_blank"\n class="').concat(quality.toLowerCase().replace("'",""),'">').concat(quality,"</a>: ").concat(price,"<br>")}}return html}},{key:"_pricesHTML",value:function _pricesHTML(){var html;html=this._priceSourceHTML();if(html){return"<div id='marketprice'><span id='pricesource'>".concat(capitalize(this.source),"</span><h3 id='prices'>").concat(html,"</h3></div>")}else{return""}}},{key:"_blueprintsHTML",value:function _blueprintsHTML(){var blueprint,chance,html,i,index,item,j,k,l,len,len1,listItem,name,ref,ref1,ref2,style,url;if(this.item.blueprints.length){html='<div id="blueprints">';ref=this.item.blueprints;for(j=0,len=ref.length;j<len;j++){blueprint=ref[j];chance=blueprint.getAttribute("data-chance");html+='<div class="blueprint">';ref1=blueprint.getElementsByTagName("li");for(k=0,len1=ref1.length;k<len1;k++){item=ref1[k];for(i=l=0,ref2=item.getAttribute("data-count");0<=ref2?l<ref2:l>ref2;i=0<=ref2?++l:--l){name=item.title;index=item.getAttribute("data-index");style="background-image: url(".concat(item.getAttribute("data-image"),")");listItem='<div title="'.concat(name,"\" class='item-small' style='").concat(style,"'></div>");url=item.getAttribute("data-url");if(!url){name=name.replace("Any ","").replace("Spy Watch","PDA2 Weapon");if(name.split(" ").length>2){name=name.replace("Weapon","Set")}url="/search?q=".concat(encodeURIComponent(name))}html+='<a href="'.concat(url,"\" target='_blank'>").concat(listItem,"</a>")}}html+='<div title="Crafting Chance" style="position: absolute; right: 10px">\n<h3>'.concat(chance,"%</h3></div></div>")}return html+="</div>"}else{return""}}},{key:"_tradeHTML",value:function _tradeHTML(){return'<form name="tradeform" method="POST" style="display: inline-block">\n\n  <input type="hidden" name="json">\n  <input type="submit" name="submit" value="Search!" style="display: none">\n\n  <select id="tradetype" class="textbox">\n    <option value="has1">Want</option>\n    <option value="wants1">Have</option>\n  </select>\n\n  <select id="quality" class="textbox">\n    <option value="6">Unique</option>\n    <option value="3">Vintage</option>\n    <option value="11">Strange</option>\n    <option value="1">Genuine</option>\n    <option value="14">Collector\'s</option>\n    <option value="13">Haunted</option>\n    <option value="5">Unusual</option>\n  </select>\n\n</form>'}},{key:"_wishlistHTML",value:function _wishlistHTML(){if(user.loggedIn){return'<div style="display: inline-block;">\n<div id="wishlistmessage"\n style="display: none; margin: 0 0 4px -18px">Added</div>\n<i id="wishlistbutton" class="fa fa-star fa-lg button-icon"\n title="Add to Wishlist"></i>\n</div>'}else{return""}}},{key:"_buttonsHTML",value:function _buttonsHTML(){var wikiLink;wikiLink="http://wiki.teamfortress.com/wiki/".concat(encodeURIComponent(this.item.name));return'<div id="buttons">\n\n<a class="fa fa-info fa-lg button-icon" target="_blank"\n title="Open in Wiki" href="'.concat(wikiLink,'"></a>\n\n<a id="market-btn" class="fa fa-shopping-cart fa-lg button-icon"\n target="_blank" title="Community Market"></a>\n\n<a id="classifieds-btn" class="fa fa-exchange fa-lg button-icon"\n target="_blank" title="Find Trades"></a>\n\n').concat(this._tradeHTML(),"\n").concat(this._wishlistHTML(),"\n</div>")}},{key:"_buyHTML",value:function _buyHTML(){if(this.item.storePrice){return'<div id="buy">\n<form style="display: inline-block">$'.concat(this.item.storePrice,'<br>\n<input type="text" value="1" size="1" id="quantity"\n class="textbox" style="text-align: right">\n</form><a href="#" target="_blank" id="buybutton"></a></div>')}else{return""}}},{key:"_nameLink",value:function _nameLink(){var link,linkButton;linkButton=document.getElementById("shortlinkbutton");link=document.getElementById("shortlink");return linkButton.onclick=function(){if(link.style.display==="none"){link.style.display="inline";linkButton.className=linkButton.className.replace("down","up");return link.getElementsByTagName("input")[0].select()}else{link.style.display="none";return linkButton.className=linkButton.className.replace("up","down")}}}},{key:"_pricesLink",value:function _pricesLink(){var _this=this;var button,prices;button=document.getElementById("pricesource");prices=document.getElementById("prices");if(this.sources.length>1){button.style.cursor="pointer";button.onclick=function(){_this._nextPriceSource();button.innerHTML=capitalize(_this.source);return prices.innerHTML=_this._priceSourceHTML()};button.onmouseover=function(){return button.style.textShadow="0 0 10px rgb(196, 241, 128)"};return button.onmouseout=function(){return button.style.textShadow=""}}}},{key:"_buttonsLink",value:function _buttonsLink(){var _this2=this;return(this.form.quality.onchange=function(){var classifieds,market,quality;market=document.getElementById("market-btn");quality=_this2.form.quality.options[_this2.form.quality.selectedIndex].text.toLowerCase().replace("unique","Unique").replace("genuine","rarity1").replace("unusual","rarity4").replace("collector's","collectors");market.href="http://steamcommunity.com/market/search?category_440_Type%5B%5D=any&category_440_Quality%5B%5D=tag_".concat(quality,"&appid=440&q=").concat(encodeURIComponent(_this2.item.name));classifieds=document.getElementById("classifieds-btn");return classifieds.href="http://backpack.tf/classifieds?item=".concat(encodeURIComponent(_this2.item.name),"&quality=").concat(_this2.form.quality.value)})()}},{key:"_wishlistLink",value:function _wishlistLink(){var _this3=this;var action,button,idx,j,len,ref,wish;if(user.isOwnPage()){ref=document.getElementsByClassName("item");for(idx=j=0,len=ref.length;j<len;idx=++j){wish=ref[idx];if(wish.getAttribute("data-i")===this.item.wishIndex){this.item.wishIndex=idx.toString();break}}}if(user.loggedIn){action="/wishlist/add";button=document.getElementById("wishlistbutton");if(user.isOwnPage()){action="/wishlist/remove";button.title="Remove from Wishlist"}return button.onclick=function(){var data;data={index:_this3.item.id,quality:_this3.form.quality.value};if(user.isOwnPage()){data={i:_this3.item.wishIndex}}return postAjax(action,data,function(response){var message;if(response==="Added"){message=document.getElementById("wishlistmessage");message.style.display="block";message.className="animated fadeInLeft";return setTimeout(function(){return message.className="animated fadeOut"},1e3)}else if(response==="Removed"){_this3.hide();return _this3.item.remove()}})}}}},{key:"_buyLink",value:function _buyLink(){var _this4=this;var button,quantity;button=document.getElementById("buybutton");if(button){quantity=document.getElementById("quantity");return(quantity.onchange=function(){return button.href="http://store.steampowered.com/buyitem/440/".concat(_this4.item.id,"/").concat(quantity.value)})()}}},{key:"_generate",value:function _generate(){var hoverArea,i,j,len,option,ref,results;this.elem.innerHTML="".concat(this._tagsHTML()).concat(this._nameHTML()).concat(this._classesHTML(),"\n").concat(this._bundleHTML(),"\n").concat(this._pricesHTML(),"\n").concat(this._blueprintsHTML(),"\n").concat(this._buttonsHTML()).concat(this._buyHTML());this.form=document.tradeform;this._nameLink();this._pricesLink();this._buttonsLink();this._wishlistLink();this._buyLink();hoverArea=this.item.elem.cloneNode(true);hoverArea.id="hoverarea";hoverArea.className="";if(this.item.imageUrl){hoverArea.setAttribute("style","background-image: url(".concat(this.item.imageUrl,")"))}this.elem.insertBefore(hoverArea,document.getElementById("blueprints")||document.getElementById("buttons"));new HoverBox(hoverArea);if(this.item.qualityNo){return this.form.quality.value=this.item.qualityNo}else if(this.item.prices[this.source]){ref=this.form.quality.options;results=[];for(i=j=0,len=ref.length;j<len;i=++j){option=ref[i];if(option.innerHTML in this.item.prices[this.source]){this.form.quality.selectedIndex=i;this.form.quality.onchange();break}else{results.push(void 0)}}return results}}}]);return ItemBox}();HoverBox=function(){"use strict";function HoverBox(area,itemBox){_classCallCheck(this,HoverBox);this._show=this._show.bind(this);this._hide=this._hide.bind(this);this._hideItemBox=this._hideItemBox.bind(this);this._moveMouse=this._moveMouse.bind(this);this._clickItem=this._clickItem.bind(this);this.itemBox=itemBox;if(area instanceof ItemBox){this.itemBox=area;area=null}this.elem=document.getElementById("hoverbox");if(!this.elem){this.elem=document.createElement("div");this.elem.id="hoverbox";document.body.appendChild(this.elem)}this._add(area)}_createClass(HoverBox,[{key:"_add",value:function _add(area){var _this5=this;var event,item,j,k,len,len1,list,ref;list=area?[area]:document.getElementsByClassName("item");for(j=0,len=list.length;j<len;j++){item=list[j];item.addEventListener("mouseout",this._hide,false);item.addEventListener("mousemove",this._moveMouse,false);item.addEventListener("mouseover",this._show,false);if(this.itemBox){item.addEventListener("click",this._clickItem,false)}}if(this.itemBox){ref=["click","touchend"];for(k=0,len1=ref.length;k<len1;k++){event=ref[k];document.addEventListener(event,this._hideItemBox,false)}return document.onkeydown=function(e){if(e.keyCode===27){return _this5.itemBox.hide()}}}}},{key:"_show",value:function _show(e){var descList,description,item;item=new Item(e.target);description=escapeHTML(item.description);if(description){if(indexOf.call(item.tags,"bundle")>=0&&description.indexOf("---")!==-1){descList=description.split("---");description="".concat(descList[0],'\n<span style="color: #95af0c">').concat(descList[1],"</span>")}description="<br>".concat(description)}this.elem.innerHTML='<div style="color: rgb(230, 230, 230)">'.concat(item.name,'</div><span style="color: gray">').concat(item.level,"</span>").concat(item.attributes).concat(description);return this.elem.style.display="block"}},{key:"_hide",value:function _hide(){return this.elem.style.display="none"}},{key:"_hideItemBox",value:function _hideItemBox(e){var el,els,ref;el=e.target;if(el.className!=="item"){els=[];while(el){els.push(el);el=el.parentNode}if(ref=this.itemBox.elem,indexOf.call(els,ref)<0){return this.itemBox.hide()}}}},{key:"_moveMouse",value:function _moveMouse(e){this.elem.style.top="".concat(e.pageY+28,"px");return this.elem.style.left="".concat(e.pageX-154,"px")}},{key:"_clickItem",value:function _clickItem(e){this.itemBox.show(e.target);e.preventDefault();return e.stopPropagation()}}]);return HoverBox}();capitalize=function capitalize(word){return word[0].toUpperCase()+word.slice(1)};escapeHTML=function escapeHTML(string){return string.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};getCookie=function getCookie(name){var cookie,cookies,j,len;cookies=document.cookie.split(";");for(j=0,len=cookies.length;j<len;j++){cookie=cookies[j];while(cookie[0]===" "){cookie=cookie.slice(1)}if(cookie.slice(0,name.length)===name){return cookie.slice(name.length+1)}}};setCookie=function setCookie(name,value,days){var date,expires;expires="";if(days){date=new Date;date.setDate(date.getDate()+days);expires=";expires=".concat(date.toUTCString())}return document.cookie="".concat(name,"=").concat(value).concat(expires)};ajax=function ajax(url,callback){var request;request=_getAjaxRequest(callback);request.open("GET",url,true);request.setRequestHeader("X-Requested-With","XMLHttpRequest");return request.send()};postAjax=function postAjax(url,data,callback){var name,request,value;request=_getAjaxRequest(callback);request.open("POST",url,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");return request.send(function(){var results;results=[];for(name in data){value=data[name];results.push("".concat(name,"=").concat(value))}return results}().join("&"))};_getAjaxRequest=function _getAjaxRequest(callback){var request;request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===4&&request.status===200){return callback(request.responseText)}};return request};root.user=new User;root.ItemBox=ItemBox;root.HoverBox=HoverBox}).call(this);
//# sourceMappingURL=main.js.map